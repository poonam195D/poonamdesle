#Dockerfile to setup jenkins-master-bode
FROM jenkins/jenkins:2.492.1-lts

# Skip setup wizard
ENV JAVA_OPTS="-Djenkins.install.runSetupWizard=false"

USER root
RUN DEBIAN_FRONTEND=noninteractive apt-get update -y && \
  DEBIAN_FRONTEND=noninteractive apt-get install -y \
  apt-transport-https \
  ca-certificates \
  curl \
  software-properties-common \
  apt-utils \
  nfs-common \
  awscli \
  mercurial && \
  apt-get clean && \
  rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
user jenkins
COPY --chown=jenkins:jenkins plugins.txt /usr/share/jenkins/ref/plugins.txt
RUN jenkins-plugin-cli -f /usr/share/jenkins/ref/plugins.txt
RUN echo 2.0 > /usr/share/jenkins/ref/jenkins.install.UpgradeWizard.state
COPY init.groovy.d/*.groovy /usr/share/jenkins/ref/init.groovy.d/
# Install Docker using the official installation script
RUN curl -fsSL https://get.docker.com | bash

# Add user and set permissions for Docker usage
RUN useradd -m dockeruser && echo "dockeruser:dockerpassword" | chpasswd && usermod -aG docker dockeruser

# Set working directory
WORKDIR /home/dockeruser

# Switch to non-root user
USER dockeruser
